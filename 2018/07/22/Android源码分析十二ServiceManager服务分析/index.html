<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>Android源码分析（十二）ServiceManager服务分析 | 网记本</title>
  <meta name="keywords" content=" 安卓源码 ">
  <meta name="description" content="Android源码分析（十二）ServiceManager服务分析 | 网记本">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="关于本站网记本   定位: 博客, 作用: 网络记事本。   2019年08月之前的文章都是转自我的博客园中的文章。通过html代码抓取，并非MarkDown书写，所以部分文章界面不是很美观，推荐点击文中的“查看原文”跳到我的博客园中查看原文。  主要功能： 搜索支持文章标题、标签(#标签)   可以评论（gittalk）   pad/手机等移动端适配  本站统计 到目前为止已经写了篇文章， 共字">
<meta property="og:type" content="website">
<meta property="og:title" content="关于">
<meta property="og:url" content="https://freefuncode.github.io/about/index.html">
<meta property="og:site_name" content="网记本">
<meta property="og:description" content="关于本站网记本   定位: 博客, 作用: 网络记事本。   2019年08月之前的文章都是转自我的博客园中的文章。通过html代码抓取，并非MarkDown书写，所以部分文章界面不是很美观，推荐点击文中的“查看原文”跳到我的博客园中查看原文。  主要功能： 搜索支持文章标题、标签(#标签)   可以评论（gittalk）   pad/手机等移动端适配  本站统计 到目前为止已经写了篇文章， 共字">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://freefuncode.github.io/about/avatar.jpg">
<meta property="og:updated_time" content="2019-09-07T13:22:40.470Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="关于">
<meta name="twitter:description" content="关于本站网记本   定位: 博客, 作用: 网络记事本。   2019年08月之前的文章都是转自我的博客园中的文章。通过html代码抓取，并非MarkDown书写，所以部分文章界面不是很美观，推荐点击文中的“查看原文”跳到我的博客园中查看原文。  主要功能： 搜索支持文章标题、标签(#标签)   可以评论（gittalk）   pad/手机等移动端适配  本站统计 到目前为止已经写了篇文章， 共字">
<meta name="twitter:image" content="https://freefuncode.github.io/about/avatar.jpg">


<link rel="icon" href="/img/favicon.png">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/atom-dark.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1"></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.0.1"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value>
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>网记本</span>
</div>

<div class="icon">
    
        
        <a title="github" href="https://github.com/FreeFunCode" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
        <a title="juejin" href="https://juejin.im/user/5ceb7d54f265da1b8466c2f5/posts" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-juejin"></use>
                </svg>
            
        </a>
        
    
        
        <a title="oschina" href="https://www.cnblogs.com/bugzone" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-oschina"></use>
                </svg>
            
        </a>
        
    
        
        <a title="jianshu" href="https://www.jianshu.com/u/ba21180e6aab" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-jianshu"></use>
                </svg>
            
        </a>
        
    
        
        <a title="email" href="mailto:940286175@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=940286175&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(82)</small></div></li>
    
        
            
            <li><div data-rel="后端"><i class="fold iconfont icon-right"></i>后端<small>(21)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="CSharp">CSharp<small>(14)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="JAVA">JAVA<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="PHP">PHP<small>(6)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Android"><i class="fold iconfont icon-right"></i>Android<small>(46)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="知识点">知识点<small>(14)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="开源框架">开源框架<small>(17)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="安卓源码">安卓源码<small>(15)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="GitHub">GitHub<small>(4)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="心情">心情<small>(5)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="前端">前端<small>(5)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="设计模式">设计模式<small>(1)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">关于</a><a style="width: 50%"  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="82">
<input type="hidden" id="yelog_site_word_count" value="157.1k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://github.com/FreeFunCode">我的GitHub</a></li>
            
            <li><a target="_blank" href="https://www.cnblogs.com/bugzone">我的博客园</a></li>
            
            <li><a target="_blank" href="https://juejin.im/user/5ceb7d54f265da1b8466c2f5/posts">我的掘金</a></li>
            
            <li><a target="_blank" href="https://www.jianshu.com/u/ba21180e6aab">我的简书</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode==13){return false;}">
        <input class="search" type="text" placeholder="Search..." autocomplete="off"id="local-search-input" >
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">日期格式化</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Linq</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">visualStudio</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">开源框架</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">安卓源码</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">地图</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">面试</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">hexo</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">IIS</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">SqlServer</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">ViewPager</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">XMLHttpRequest</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">fiddler</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">BroadcastReceiver</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">Activity</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">职业发展</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">电影</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">跳槽</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">图片保存</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">c#</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">easyui</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">php</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Android</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">序列化</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">mongodb</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">评论插件</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">正则表达式</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">AIDL</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">公众号</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">设计模式</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">ContentProvider</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Android7.0</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Excel操作</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Service</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">GitHub</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">nodejs</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">LNMP</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">C#文件上传</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">mono_for_Android</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">新浪SAE</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">京东云擎</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">MAMP</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class="后端 CSharp "
           href="/2014/05/08/002-DateFormat/"
           data-tag="日期格式化"
           data-author="" >
            <span class="post-title" title="C#/JavaScript/SqlServer 对日期时间的操作整理汇总">C#/JavaScript/SqlServer 对日期时间的操作整理汇总</span>
            <span class="post-date" title="2014-05-08 14:17:15">2014/05/08</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2014/05/27/003-c-Linq/"
           data-tag="Linq"
           data-author="" >
            <span class="post-title" title="Linq中int转String（解决LINQ to Entities 不识别方法&#34;System.String ToString()&#34;,因此该方法无法转换为存储表达式.）">Linq中int转String（解决LINQ to Entities 不识别方法&#34;System.String ToString()&#34;,因此该方法无法转换为存储表达式.）</span>
            <span class="post-date" title="2014-05-27 17:03:35">2014/05/27</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2014/07/25/005-“VS无法连接远程数据库”解决方案/"
           data-tag="visualStudio"
           data-author="" >
            <span class="post-title" title="“VS无法连接远程数据库”解决方案">“VS无法连接远程数据库”解决方案</span>
            <span class="post-date" title="2014-07-25 09:28:00">2014/07/25</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2019/09/04/Android开源框架八注解框架-ButterKnife/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 八 ) 注解框架---ButterKnife">Android 开源框架 ( 八 ) 注解框架---ButterKnife</span>
            <span class="post-date" title="2019-09-04 20:03:06">2019/09/04</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/08/12/Android开源框架十六视频播放器-JiaoZiVideoPlayer-JieCaoVideoPlayer/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 十六 ) 视频播放器 --- JiaoZiVideoPlayer(JieCaoVideoPlayer)">Android 开源框架 ( 十六 ) 视频播放器 --- JiaoZiVideoPlayer(JieCaoVideoPlayer)</span>
            <span class="post-date" title="2018-08-12 16:07:37">2018/08/12</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/08/05/Android开源框架十图片加载框架-Picasso/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 十 ) 图片加载框架---Picasso">Android 开源框架 ( 十 ) 图片加载框架---Picasso</span>
            <span class="post-date" title="2018-08-05 13:56:31">2018/08/05</span>
        </a>
        
        <a id="top" class="Android 开源框架 "
           href="/2018/08/05/Android开源框架系列导读/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 系列 导读">Android 开源框架 系列 导读</span>
            <span class="post-date" title="2018-08-05 22:15:29">2018/08/05</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/06/18/Android源码分析一开篇介绍/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android 源码分析（一） 开篇介绍">Android 源码分析（一） 开篇介绍</span>
            <span class="post-date" title="2018-06-18 19:47:55">2018/06/18</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2014/11/08/Arcgis-地图-服务器安装配置/"
           data-tag="地图"
           data-author="" >
            <span class="post-title" title="Arcgis-地图-服务器安装配置">Arcgis-地图-服务器安装配置</span>
            <span class="post-date" title="2014-11-08 04:00:13">2014/11/08</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2019/08/25/Android面试题/"
           data-tag="面试"
           data-author="" >
            <span class="post-title" title="Android面试题">Android面试题</span>
            <span class="post-date" title="2019-08-25 22:31:56">2019/08/25</span>
        </a>
        
        <a  class="GitHub "
           href="/2014/04/27/Hello-Hexo/"
           data-tag="hexo"
           data-author="" >
            <span class="post-title" title="Hello Hexo">Hello Hexo</span>
            <span class="post-date" title="2014-04-27 19:20:47">2014/04/27</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2014/09/15/IIS网站应用偶尔出现服务不可用解决办法/"
           data-tag="IIS"
           data-author="" >
            <span class="post-title" title="IIS网站应用偶尔出现服务不可用解决办法">IIS网站应用偶尔出现服务不可用解决办法</span>
            <span class="post-date" title="2014-09-15 13:40:05">2014/09/15</span>
        </a>
        
        <a  class="后端 JAVA "
           href="/2018/07/01/Java基础面试题汇总/"
           data-tag="面试"
           data-author="" >
            <span class="post-title" title="Java基础面试题汇总">Java基础面试题汇总</span>
            <span class="post-date" title="2018-07-01 04:16:31">2018/07/01</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2015/06/01/VS发布报错未能将文件……复制到……/"
           data-tag="visualStudio"
           data-author="" >
            <span class="post-title" title="VS发布报错未能将文件……复制到……">VS发布报错未能将文件……复制到……</span>
            <span class="post-date" title="2015-06-01 21:25:08">2015/06/01</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2014/12/02/SqlServer数据库添加角色，角色授权/"
           data-tag="SqlServer"
           data-author="" >
            <span class="post-title" title="SqlServer数据库添加角色，角色授权">SqlServer数据库添加角色，角色授权</span>
            <span class="post-date" title="2014-12-02 17:15:01">2014/12/02</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2018/07/21/ViewPager相关使用/"
           data-tag="ViewPager"
           data-author="" >
            <span class="post-title" title="ViewPager相关使用">ViewPager相关使用</span>
            <span class="post-date" title="2018-07-21 23:59:41">2018/07/21</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2014/09/28/XMLHttpRequest异步方式和同步方式/"
           data-tag="XMLHttpRequest"
           data-author="" >
            <span class="post-title" title="XMLHttpRequest异步方式和同步方式">XMLHttpRequest异步方式和同步方式</span>
            <span class="post-date" title="2014-09-28 20:19:04">2014/09/28</span>
        </a>
        
        <a  class="GitHub "
           href="/2014/04/26/hello-world/"
           data-tag="hexo"
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2014-04-26 19:10:17">2014/04/26</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2018/05/06/使用fiddler抓手机端http数据包/"
           data-tag="fiddler"
           data-author="" >
            <span class="post-title" title="使用fiddler抓手机端http数据包">使用fiddler抓手机端http数据包</span>
            <span class="post-date" title="2018-05-06 19:48:10">2018/05/06</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2018/05/16/四大组件-三-BroadcastReceiver介绍/"
           data-tag="BroadcastReceiver"
           data-author="" >
            <span class="post-title" title="Android 四大组件 (三) BroadcastReceiver 介绍">Android 四大组件 (三) BroadcastReceiver 介绍</span>
            <span class="post-date" title="2018-05-16 12:33:39">2018/05/16</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2018/04/11/四大组件-一-Activity生命周期/"
           data-tag="Activity"
           data-author="" >
            <span class="post-title" title="Android 四大组件 (一) Activity 生命周期">Android 四大组件 (一) Activity 生命周期</span>
            <span class="post-date" title="2018-04-11 20:00:39">2018/04/11</span>
        </a>
        
        <a  class="GitHub "
           href="/2014/11/23/在GitHub上搭建hexo博客/"
           data-tag="hexo"
           data-author="" >
            <span class="post-title" title="在GitHub上搭建hexo博客">在GitHub上搭建hexo博客</span>
            <span class="post-date" title="2014-11-23 14:06:58">2014/11/23</span>
        </a>
        
        <a  class="心情 "
           href="/2015/11/14/最近的一些感想（关于移动客户端开发android-ios）/"
           data-tag="职业发展"
           data-author="" >
            <span class="post-title" title="最近的一些感想（关于移动客户端开发android,ios）">最近的一些感想（关于移动客户端开发android,ios）</span>
            <span class="post-date" title="2015-11-14 22:39:55">2015/11/14</span>
        </a>
        
        <a  class="心情 "
           href="/2019/09/22/汉尼拔电影观后感/"
           data-tag="电影"
           data-author="" >
            <span class="post-title" title="汉尼拔电影观后感">汉尼拔电影观后感</span>
            <span class="post-date" title="2019-09-22 13:00:36">2019/09/22</span>
        </a>
        
        <a  class="心情 "
           href="/2016/08/27/第二次裸辞-潜伏期-一些感想/"
           data-tag="跳槽"
           data-author="" >
            <span class="post-title" title="第二次裸辞_潜伏期_一些感想">第二次裸辞_潜伏期_一些感想</span>
            <span class="post-date" title="2016-08-27 16:12:25">2016/08/27</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/08/07/开源框架十五下拉刷新框架-SwipeRefreshLayout/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 十五 ) 下拉刷新框架 --- SwipeRefreshLayout">Android 开源框架 ( 十五 ) 下拉刷新框架 --- SwipeRefreshLayout</span>
            <span class="post-date" title="2018-08-07 20:28:54">2018/08/07</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2018/04/13/解决问题：保存图片到本地文件夹后，在图库里看不到保存的图片问题。/"
           data-tag="图片保存"
           data-author="" >
            <span class="post-title" title="解决问题：保存图片到本地文件夹后，在图库里看不到保存的图片问题。">解决问题：保存图片到本地文件夹后，在图库里看不到保存的图片问题。</span>
            <span class="post-date" title="2018-04-13 20:26:54">2018/04/13</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2015/06/07/错误：类型System-Object未定义或者不能引入项目/"
           data-tag="c#"
           data-author="" >
            <span class="post-title" title="错误：类型System.Object未定义或者不能引入项目">错误：类型System.Object未定义或者不能引入项目</span>
            <span class="post-date" title="2015-06-07 14:33:14">2015/06/07</span>
        </a>
        
        <a  class="前端 "
           href="/2014/07/14/004-easyui的-getSelections-与-getSelected-对比区别/"
           data-tag="easyui"
           data-author="" >
            <span class="post-title" title="easyui的 getSelections 与 getSelected 对比区别">easyui的 getSelections 与 getSelected 对比区别</span>
            <span class="post-date" title="2014-07-14 14:11:27">2014/07/14</span>
        </a>
        
        <a  class="后端 PHP "
           href="/2014/08/21/00Windows下搭建PHP开发环境，整合Apache-PHP-MySQL（举例软件为32位）/"
           data-tag="php"
           data-author="" >
            <span class="post-title" title="Windows下搭建PHP开发环境，整合Apache+PHP+MySQL（举例软件为32位）">Windows下搭建PHP开发环境，整合Apache+PHP+MySQL（举例软件为32位）</span>
            <span class="post-date" title="2014-08-21 15:42:28">2014/08/21</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2018/07/14/Android8-0新特性介绍以及注意事项/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Android8.0新特性介绍以及注意事项">Android8.0新特性介绍以及注意事项</span>
            <span class="post-date" title="2018-07-14 13:13:38">2018/07/14</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/07/28/Android开源框架一OkHttp网络框架的基本使用/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 一 ) OkHttp 网络框架的基本使用">Android 开源框架 ( 一 ) OkHttp 网络框架的基本使用</span>
            <span class="post-date" title="2018-07-28 14:21:25">2018/07/28</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/08/05/Android开源框架九图片加载框架-ImageLoader/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 九 ) 图片加载框架---ImageLoader">Android 开源框架 ( 九 ) 图片加载框架---ImageLoader</span>
            <span class="post-date" title="2018-08-05 13:00:34">2018/08/05</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/08/05/Android开源框架十一图片加载框架-Glide/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 十一 ) 图片加载框架---Glide">Android 开源框架 ( 十一 ) 图片加载框架---Glide</span>
            <span class="post-date" title="2018-08-05 14:07:01">2018/08/05</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/07/07/Android源码分析八Launcher桌面启动App过程/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android 源码分析（八） Launcher 桌面启动App过程">Android 源码分析（八） Launcher 桌面启动App过程</span>
            <span class="post-date" title="2018-07-07 20:13:12">2018/07/07</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/07/22/Android源码分析十三ActivityManagerService服务分析/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android源码分析（十三）ActivityManagerService服务分析">Android源码分析（十三）ActivityManagerService服务分析</span>
            <span class="post-date" title="2018-07-22 13:33:13">2018/07/22</span>
        </a>
        
        <a id="top" class="Android 安卓源码 "
           href="/2018/07/22/Android进阶学习笔记整理/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android进阶学习笔记整理">Android进阶学习笔记整理</span>
            <span class="post-date" title="2018-07-22 16:27:43">2018/07/22</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2018/07/22/Serializable和Parcelable之序列化/"
           data-tag="序列化"
           data-author="" >
            <span class="post-title" title="Serializable和Parcelable之序列化">Serializable和Parcelable之序列化</span>
            <span class="post-date" title="2018-07-22 00:28:23">2018/07/22</span>
        </a>
        
        <a  class="前端 "
           href="/2014/08/24/mongodb在windows下安装教程/"
           data-tag="mongodb"
           data-author="" >
            <span class="post-title" title="mongodb在windows下安装教程">mongodb在windows下安装教程</span>
            <span class="post-date" title="2014-08-24 02:10:01">2014/08/24</span>
        </a>
        
        <a  class="前端 "
           href="/2014/11/20/推荐三款使用社会化评论插件/"
           data-tag="评论插件"
           data-author="" >
            <span class="post-title" title="推荐三款使用社会化评论插件">推荐三款使用社会化评论插件</span>
            <span class="post-date" title="2014-11-20 23:24:39">2014/11/20</span>
        </a>
        
        <a  class="心情 "
           href="/2015/04/27/跳槽穷半年-转行穷三年-死守会穷一辈子/"
           data-tag="跳槽"
           data-author="" >
            <span class="post-title" title="跳槽穷半年,转行穷三年,死守会穷一辈子">跳槽穷半年,转行穷三年,死守会穷一辈子</span>
            <span class="post-date" title="2015-04-27 20:49:33">2015/04/27</span>
        </a>
        
        <a  class="心情 "
           href="/2019/09/28/巴比龙电影观后感/"
           data-tag="电影"
           data-author="" >
            <span class="post-title" title="《巴比龙》电影观后感">《巴比龙》电影观后感</span>
            <span class="post-date" title="2019-09-28 13:06:52">2019/09/28</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2014/05/07/001-RegEx/"
           data-tag="正则表达式"
           data-author="" >
            <span class="post-title" title="《正则表达式》知识点汇总摘录">《正则表达式》知识点汇总摘录</span>
            <span class="post-date" title="2014-05-07 16:17:16">2014/05/07</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2018/07/21/AIDL介绍以及简单使用/"
           data-tag="AIDL"
           data-author="" >
            <span class="post-title" title="AIDL介绍以及简单使用">AIDL介绍以及简单使用</span>
            <span class="post-date" title="2018-07-21 13:05:21">2018/07/21</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/08/02/Android开源框架七事件总线-EventBus/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 七 ) 事件总线---EventBus">Android 开源框架 ( 七 ) 事件总线---EventBus</span>
            <span class="post-date" title="2018-08-02 22:54:14">2018/08/02</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/07/30/Android开源框架五xUtils-Android里的ORM-IOC聚合型框架/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 五 ) xUtils --- Android 里的 ORM IOC聚合型框架">Android 开源框架 ( 五 ) xUtils --- Android 里的 ORM IOC聚合型框架</span>
            <span class="post-date" title="2018-07-30 23:55:54">2018/07/30</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/07/29/Android开源框架二基于OkHttp进一步封装的okhttp-utils介绍/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 二 ) 基于OkHttp进一步封装的okhttp-utils介绍">Android 开源框架 ( 二 ) 基于OkHttp进一步封装的okhttp-utils介绍</span>
            <span class="post-date" title="2018-07-29 11:24:14">2018/07/29</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/08/05/Android开源框架十三RecyclerView/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 十三 ) RecyclerView">Android 开源框架 ( 十三 ) RecyclerView</span>
            <span class="post-date" title="2018-08-05 21:19:57">2018/08/05</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/07/30/Android开源框架四Afinal-Android里的ORM-IOC聚合型框架/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 四 ) Afinal --- Android 里的 ORM IOC聚合型框架">Android 开源框架 ( 四 ) Afinal --- Android 里的 ORM IOC聚合型框架</span>
            <span class="post-date" title="2018-07-30 23:07:12">2018/07/30</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/07/09/Android源码分析十Dalvik虚拟机创建过程/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android 源码分析（十） Dalvik 虚拟机创建过程">Android 源码分析（十） Dalvik 虚拟机创建过程</span>
            <span class="post-date" title="2018-07-09 21:04:17">2018/07/09</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/07/22/Android源码分析十四PackageManagerService服务分析/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android源码分析（十四）PackageManagerService服务分析">Android源码分析（十四）PackageManagerService服务分析</span>
            <span class="post-date" title="2018-07-22 14:59:30">2018/07/22</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/07/07/Android源码分析五Zygote进程/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android 源码分析（五） Zygote 进程">Android 源码分析（五） Zygote 进程</span>
            <span class="post-date" title="2018-07-07 14:14:54">2018/07/07</span>
        </a>
        
        <a  class="前端 "
           href="/2015/06/02/easyui换主题，并记录在cookie-以及cookie作用域介绍/"
           data-tag="easyui"
           data-author="" >
            <span class="post-title" title="easyui换主题，并记录在cookie.以及cookie作用域介绍">easyui换主题，并记录在cookie.以及cookie作用域介绍</span>
            <span class="post-date" title="2015-06-02 21:22:20">2015/06/02</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/08/07/开源框架十四列表下拉刷新框架-SmartRefreshLayout/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 十四 ) 列表下拉刷新框架 --- SmartRefreshLayout">Android 开源框架 ( 十四 ) 列表下拉刷新框架 --- SmartRefreshLayout</span>
            <span class="post-date" title="2018-08-07 20:23:00">2018/08/07</span>
        </a>
        
        <a  class="后端 PHP "
           href="/2014/11/28/超简单微信公众帐号自动回复和天气播报功能应用/"
           data-tag="公众号"
           data-author="" >
            <span class="post-title" title="超简单微信公众帐号自动回复和天气播报功能应用">超简单微信公众帐号自动回复和天气播报功能应用</span>
            <span class="post-date" title="2014-11-28 14:30:13">2014/11/28</span>
        </a>
        
        <a  class="设计模式 "
           href="/2018/07/06/23种设计模式在Android中的应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="23种设计模式在Android中的应用">23种设计模式在Android中的应用</span>
            <span class="post-date" title="2018-07-06 23:37:49">2018/07/06</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2018/06/18/Android四大组件-四-ContentProvider介绍/"
           data-tag="ContentProvider"
           data-author="" >
            <span class="post-title" title="Android 四大组件 (四) ContentProvider介绍">Android 四大组件 (四) ContentProvider介绍</span>
            <span class="post-date" title="2018-06-18 03:29:27">2018/06/18</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2018/07/19/Android四大组件-五-第五大组件Fragment使用/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Android 四大组件 (五) 第五大组件 - Fragment 使用">Android 四大组件 (五) 第五大组件 - Fragment 使用</span>
            <span class="post-date" title="2018-07-19 09:20:09">2018/07/19</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/08/01/Android开源框架六Volley-Google的轻量级网络通信框架/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 六 ) Volley --- Google的轻量级网络通信框架">Android 开源框架 ( 六 ) Volley --- Google的轻量级网络通信框架</span>
            <span class="post-date" title="2018-08-01 07:36:18">2018/08/01</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/07/08/Android源码分析九Init启动分析/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android 源码分析（九） Init 启动分析">Android 源码分析（九） Init 启动分析</span>
            <span class="post-date" title="2018-07-08 23:05:42">2018/07/08</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2018/07/28/Android7-0下载APK后自动安装/"
           data-tag="Android7.0"
           data-author="" >
            <span class="post-title" title="Android7.0下载APK后自动安装">Android7.0下载APK后自动安装</span>
            <span class="post-date" title="2018-07-28 18:57:46">2018/07/28</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/07/29/Android开源框架三基于OkHttp进一步封装的OkHttpUtils介绍/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 三 ) 基于OkHttp进一步封装的OkHttpUtils介绍">Android 开源框架 ( 三 ) 基于OkHttp进一步封装的OkHttpUtils介绍</span>
            <span class="post-date" title="2018-07-29 22:51:43">2018/07/29</span>
        </a>
        
        <a  class="Android 开源框架 "
           href="/2018/08/05/Android开源框架十二图片加载框架-Fresco/"
           data-tag="开源框架"
           data-author="" >
            <span class="post-title" title="Android 开源框架 ( 十二 ) 图片加载框架---Fresco">Android 开源框架 ( 十二 ) 图片加载框架---Fresco</span>
            <span class="post-date" title="2018-08-05 18:43:27">2018/08/05</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/07/15/Android源码分析十一事件传递机制/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android 源码分析（十一） 事件传递机制">Android 源码分析（十一） 事件传递机制</span>
            <span class="post-date" title="2018-07-15 13:18:25">2018/07/15</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/07/22/Android源码分析十二ServiceManager服务分析/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android源码分析（十二）ServiceManager服务分析">Android源码分析（十二）ServiceManager服务分析</span>
            <span class="post-date" title="2018-07-22 11:44:46">2018/07/22</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/07/07/Android源码分析四Handler异步消息机制/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android 源码分析（四） Handler 异步消息机制">Android 源码分析（四） Handler 异步消息机制</span>
            <span class="post-date" title="2018-07-07 12:40:19">2018/07/07</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2014/11/09/使用“天地图”实现“百度地图”的GPS单点沿线运动，来模拟物体运动轨迹。/"
           data-tag="地图"
           data-author="" >
            <span class="post-title" title="使用“天地图”实现“百度地图”的GPS单点沿线运动，来模拟物体运动轨迹。">使用“天地图”实现“百度地图”的GPS单点沿线运动，来模拟物体运动轨迹。</span>
            <span class="post-date" title="2014-11-09 17:10:29">2014/11/09</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/07/07/Android源码分析七Launcher桌面程序启动分析/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android 源码分析（七） Launcher 桌面程序启动分析">Android 源码分析（七） Launcher 桌面程序启动分析</span>
            <span class="post-date" title="2018-07-07 19:51:44">2018/07/07</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/07/07/Android源码分析六SystemServer进程/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android 源码分析（六） SystemServer 进程">Android 源码分析（六） SystemServer 进程</span>
            <span class="post-date" title="2018-07-07 15:14:19">2018/07/07</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2014/12/02/使用SqlBulkCopy实现Excel批量导入数据库/"
           data-tag="Excel操作"
           data-author="" >
            <span class="post-title" title="使用SqlBulkCopy实现Excel批量导入数据库">使用SqlBulkCopy实现Excel批量导入数据库</span>
            <span class="post-date" title="2014-12-02 18:05:14">2014/12/02</span>
        </a>
        
        <a  class="Android 知识点 "
           href="/2018/05/13/四大组件-二-Service使用/"
           data-tag="Service"
           data-author="" >
            <span class="post-title" title="Android 四大组件 (二) Service 使用">Android 四大组件 (二) Service 使用</span>
            <span class="post-date" title="2018-05-13 23:46:47">2018/05/13</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/06/24/Android源码分析三Service启动分析/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android 源码分析（三） Service 启动分析">Android 源码分析（三） Service 启动分析</span>
            <span class="post-date" title="2018-06-24 14:24:40">2018/06/24</span>
        </a>
        
        <a  class="GitHub "
           href="/2014/08/24/GitHub在windows上代码管理教程/"
           data-tag="GitHub"
           data-author="" >
            <span class="post-title" title="GitHub在windows上代码管理教程">GitHub在windows上代码管理教程</span>
            <span class="post-date" title="2014-08-24 04:03:23">2014/08/24</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2014/08/20/006-IIS7发布-EF-MVC项目提示404-0页面错误解决方案/"
           data-tag="IIS"
           data-author="" >
            <span class="post-title" title="IIS7发布 EF MVC项目提示404.0页面错误解决方案">IIS7发布 EF MVC项目提示404.0页面错误解决方案</span>
            <span class="post-date" title="2014-08-20 09:29:00">2014/08/20</span>
        </a>
        
        <a  class="前端 "
           href="/2014/08/24/nodejs在windows平台下搭建部署环境教程/"
           data-tag="nodejs"
           data-author="" >
            <span class="post-title" title="nodejs在windows平台下搭建部署环境教程">nodejs在windows平台下搭建部署环境教程</span>
            <span class="post-date" title="2014-08-24 01:30:43">2014/08/24</span>
        </a>
        
        <a  class="后端 PHP "
           href="/2014/09/06/在vmware虚拟机中安装centos系统并使用LNMP安装部署环境/"
           data-tag="LNMP"
           data-author="" >
            <span class="post-title" title="在vmware虚拟机中安装centos系统并使用LNMP安装部署环境">在vmware虚拟机中安装centos系统并使用LNMP安装部署环境</span>
            <span class="post-date" title="2014-09-06 11:32:34">2014/09/06</span>
        </a>
        
        <a  class="Android 安卓源码 "
           href="/2018/06/24/Android源码分析二Activity启动分析/"
           data-tag="安卓源码"
           data-author="" >
            <span class="post-title" title="Android 源码分析（二） Activity 启动分析">Android 源码分析（二） Activity 启动分析</span>
            <span class="post-date" title="2018-06-24 03:26:17">2018/06/24</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2014/09/03/使用uploadify上传大文件报IOerror-2038错误的解决方案/"
           data-tag="C#文件上传"
           data-author="" >
            <span class="post-title" title="使用uploadify上传大文件报IOerror#2038错误的解决方案">使用uploadify上传大文件报IOerror#2038错误的解决方案</span>
            <span class="post-date" title="2014-09-03 16:42:58">2014/09/03</span>
        </a>
        
        <a  class="后端 CSharp "
           href="/2014/09/12/mono-for-Android环境配置-环境搭建-破解方法-运行一个小程序/"
           data-tag="mono_for_Android"
           data-author="" >
            <span class="post-title" title="mono_for_Android环境配置-环境搭建+破解方法+运行一个小程序-">mono_for_Android环境配置-环境搭建+破解方法+运行一个小程序-</span>
            <span class="post-date" title="2014-09-12 13:50:06">2014/09/12</span>
        </a>
        
        <a  class="后端 PHP "
           href="/2014/08/24/在新浪SAE上搭建自己的网站！/"
           data-tag="新浪SAE"
           data-author="" >
            <span class="post-title" title="在新浪SAE上搭建自己的网站！">在新浪SAE上搭建自己的网站！</span>
            <span class="post-date" title="2014-08-24 21:45:51">2014/08/24</span>
        </a>
        
        <a  class="后端 PHP "
           href="/2014/08/26/在京东云擎上搭建自己的网站/"
           data-tag="京东云擎"
           data-author="" >
            <span class="post-title" title="在京东云擎上搭建自己的网站">在京东云擎上搭建自己的网站</span>
            <span class="post-date" title="2014-08-26 19:51:03">2014/08/26</span>
        </a>
        
        <a  class="后端 PHP "
           href="/2014/09/06/在vmware虚拟机中安装MacOSXMountainLion10-8-2系统并使用MAMP安装部署环境/"
           data-tag="MAMP"
           data-author="" >
            <span class="post-title" title="在vmware虚拟机中安装MacOSXMountainLion10.8.2系统并使用MAMP安装部署环境">在vmware虚拟机中安装MacOSXMountainLion10.8.2系统并使用MAMP安装部署环境</span>
            <span class="post-date" title="2014-09-06 12:41:21">2014/09/06</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-Android源码分析十二ServiceManager服务分析" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Android源码分析（十二）ServiceManager服务分析</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a href="javascript:" data-rel="Android">Android</a>/
            
                <a href="javascript:" data-rel="安卓源码">安卓源码</a>
            
        </span>
        
        
        <span class="tag">
            
            <a href="javascript:" class="color5">安卓源码</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2019-09-06 21:20:05'>2018-07-22 11:44</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:6.2k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#cnblogs_post_body"><span class="toc-text">一.启动过程分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cnblogs_post_body"><span class="toc-text">二. ServiceManager如何管理服务</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://www.cnblogs.com/bugzone/p/ServiceManager.html" target="_blank" rel="noopener">点击查看原文</a></p>
<div id="cnblogs_post_body" class="blogpost-body ">
    <h2>一.启动过程分析</h2>
<div>基于 binder 机制实现通信，添加服务，查询服务，获取服务。查询，获取服务时候需要检查权限，android是基于Linux底层，所以也很好的实现了linux多用户管理。</div>
<div>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #000000;">frameworks\native\cmds\servicemanager\servicemanager.rc
service servicemanager </span>/system/bin/<span style="color: #000000;">servicemanager
    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> core animation
    user system
    group system readproc
    critical
    onrestart restart healthd
    onrestart restart zygote
    onrestart restart audioserver
    onrestart restart media
    onrestart restart surfaceflinger
    onrestart restart inputflinger
    onrestart restart drm
    onrestart restart cameraserver
    writepid </span>/dev/cpuset/system-background/tasks</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div>
<p>从上面可知，如果ServiceManager服务异常退出的话，系统会重启。</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #000000;">frameworks\native\cmds\servicemanager\service_manager.c
</span><span style="color: #0000ff;">int</span> main(<span style="color: #0000ff;">int</span> argc, <span style="color: #0000ff;">char</span>**<span style="color: #000000;"> argv)
{
    </span><span style="color: #0000ff;">struct</span> binder_state *<span style="color: #000000;">bs;
    union selinux_callback cb;
    </span><span style="color: #0000ff;">char</span> *<span style="color: #000000;">driver;

<pre><code>&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (argc &amp;gt; &lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;) {
    driver &lt;/span&gt;= argv[&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;];
} &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; {
    driver &lt;/span&gt;= &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;/dev/binder&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}

bs &lt;/span&gt;= binder_open(driver, &lt;span style=&quot;color: #800080;&quot;&gt;128&lt;/span&gt;*&lt;span style=&quot;color: #800080;&quot;&gt;1024&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (!&lt;span style=&quot;color: #000000;&quot;&gt;bs) {
#ifdef VENDORSERVICEMANAGER
    ALOGW(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;failed to open binder driver %s\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;, driver);
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;while&lt;/span&gt; (&lt;span style=&quot;color: #0000ff;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;) {
        sleep(UINT_MAX);
    }
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;#else&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;
    ALOGE(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;failed to open binder driver %s\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;, driver);
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;#endif&lt;/span&gt;
    &lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (binder_become_context_manager(bs)) {
    ALOGE(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;cannot become context manager (%s)\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;, strerror(errno));
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}

cb.func_audit &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; audit_callback;
selinux_set_callback(SELINUX_CB_AUDIT, cb);
cb.func_log &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; selinux_log_callback;
selinux_set_callback(SELINUX_CB_LOG, cb);

#ifdef VENDORSERVICEMANAGER
sehandle &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; selinux_android_vendor_service_context_handle();
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;#else&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;
sehandle &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; selinux_android_service_context_handle();
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;#endif&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;
selinux_status_open(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (sehandle ==&lt;span style=&quot;color: #000000;&quot;&gt; NULL) {
    ALOGE(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;SELinux: Failed to acquire sehandle. Aborting.\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
    abort();
}

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (getcon(&amp;amp;service_manager_context) != &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;) {
    ALOGE(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;SELinux: Failed to acquire service_manager context. Aborting.\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
    abort();
}


&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;loop 接受消息。并将binder解析完的消息返回给svcmgr_handler处理。&lt;/span&gt;</code></pre><p><span style="color: #000000;">    binder_loop(bs, svcmgr_handler);</span></p>
<pre><code>&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;</code></pre><p>}</p></span></pre><p></p>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div>
<p>从这我们知道，ServiceManager是基于binder机制实现的。进入binder.c中了解下binder_open,binder_loop，然后binder将解析完的消息，返回给svcmag_handler处理</p>
<p>frameworks\native\cmds\servicemanager\binder.c</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('c271bc75-156b-40e2-ae92-90551ddf233c')"><img id="code_img_closed_c271bc75-156b-40e2-ae92-90551ddf233c" class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img id="code_img_opened_c271bc75-156b-40e2-ae92-90551ddf233c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c271bc75-156b-40e2-ae92-90551ddf233c',event)" src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt>
<div id="cnblogs_code_open_c271bc75-156b-40e2-ae92-90551ddf233c" class="cnblogs_code_hide">
<pre>    <span style="color: #0000ff;">struct</span> binder_state *binder_open(<span style="color: #0000ff;">const</span> <span style="color: #0000ff;">char</span>*<span style="color: #000000;"> driver, size_t mapsize)
{
    </span><span style="color: #0000ff;">struct</span> binder_state *<span style="color: #000000;">bs;
    </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> binder_version vers;

<pre><code>bs &lt;/span&gt;= malloc(&lt;span style=&quot;color: #0000ff;&quot;&gt;sizeof&lt;/span&gt;(*&lt;span style=&quot;color: #000000;&quot;&gt;bs));
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (!&lt;span style=&quot;color: #000000;&quot;&gt;bs) {
    errno &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; ENOMEM;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; NULL;
}

bs&lt;/span&gt;-&amp;gt;fd = open(driver, O_RDWR |&lt;span style=&quot;color: #000000;&quot;&gt; O_CLOEXEC);
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (bs-&amp;gt;fd &amp;lt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;) {
    fprintf(stderr,&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;binder: cannot open %s (%s)\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;,
            driver, strerror(errno));
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;goto&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; fail_open;
}

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; ((ioctl(bs-&amp;gt;fd, BINDER_VERSION, &amp;amp;vers) == -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;) ||&lt;span style=&quot;color: #000000;&quot;&gt;
    (vers.protocol_version &lt;/span&gt;!=&lt;span style=&quot;color: #000000;&quot;&gt; BINDER_CURRENT_PROTOCOL_VERSION)) {
    fprintf(stderr,
            &lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;binder: kernel driver version (%d) differs from user space version (%d)\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;,
            vers.protocol_version, BINDER_CURRENT_PROTOCOL_VERSION);
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;goto&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; fail_open;
}

bs&lt;/span&gt;-&amp;gt;mapsize =&lt;span style=&quot;color: #000000;&quot;&gt; mapsize;
bs&lt;/span&gt;-&amp;gt;mapped = mmap(NULL, mapsize, PROT_READ, MAP_PRIVATE, bs-&amp;gt;fd, &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (bs-&amp;gt;mapped ==&lt;span style=&quot;color: #000000;&quot;&gt; MAP_FAILED) {
    fprintf(stderr,&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;binder: cannot map device (%s)\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;,
            strerror(errno));
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;goto&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; fail_map;
}

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; bs;</code></pre><p>}</p></span></pre><p></p>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('5c06b747-4566-4459-8bff-9b4c249774c5')"><img id="code_img_closed_5c06b747-4566-4459-8bff-9b4c249774c5" class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img id="code_img_opened_5c06b747-4566-4459-8bff-9b4c249774c5" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('5c06b747-4566-4459-8bff-9b4c249774c5',event)" src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt>
<div id="cnblogs_code_open_5c06b747-4566-4459-8bff-9b4c249774c5" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">void</span> binder_loop(<span style="color: #0000ff;">struct</span> binder_state *<span style="color: #000000;">bs, binder_handler func)
{
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> res;
    </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> binder_write_read bwr;
    uint32_t readbuf[</span><span style="color: #800080;">32</span><span style="color: #000000;">];

<pre><code>bwr.write_size &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
bwr.write_consumed &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
bwr.write_buffer &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;

readbuf[&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;] =&lt;span style=&quot;color: #000000;&quot;&gt; BC_ENTER_LOOPER;
binder_write(bs, readbuf, &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(uint32_t));

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (;;) {
    bwr.read_size &lt;/span&gt;= &lt;span style=&quot;color: #0000ff;&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(readbuf);
    bwr.read_consumed &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    bwr.read_buffer &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; (uintptr_t) readbuf;

    res &lt;/span&gt;= ioctl(bs-&amp;gt;fd, BINDER_WRITE_READ, &amp;amp;&lt;span style=&quot;color: #000000;&quot;&gt;bwr);

    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (res &amp;lt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;) {
        ALOGE(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;binder_loop: ioctl failed (%s)\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;, strerror(errno));
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    }

    &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;解析消息&lt;/span&gt;
    res = binder_parse(bs, &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;, (uintptr_t) readbuf, bwr.read_consumed, func);
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (res == &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;) {
        ALOGE(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;binder_loop: unexpected reply?!\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    }
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (res &amp;lt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;) {
        ALOGE(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;binder_loop: io error %d %s\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;, res, strerror(errno));
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    }
}</code></pre><p>}</p></span></pre><p></p>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div>binder_parse 解析接受到的消息&nbsp;</div>
<div>binder_send_reply 接收到消息，并解析完消息后，binder将解析后的消息返回给ServiceManager</div>
<div>
<div class="cnblogs_code" onclick="cnblogs_code_show('4aebc7de-d31e-48f8-9dbc-8ae2582c5d95')"><img id="code_img_closed_4aebc7de-d31e-48f8-9dbc-8ae2582c5d95" class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img id="code_img_opened_4aebc7de-d31e-48f8-9dbc-8ae2582c5d95" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('4aebc7de-d31e-48f8-9dbc-8ae2582c5d95',event)" src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt>
<div id="cnblogs_code_open_4aebc7de-d31e-48f8-9dbc-8ae2582c5d95" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">void</span> binder_send_reply(<span style="color: #0000ff;">struct</span> binder_state *<span style="color: #000000;">bs,
                       </span><span style="color: #0000ff;">struct</span> binder_io *<span style="color: #000000;">reply,
                       binder_uintptr_t buffer_to_free,
                       </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> status)
{
    </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> {
        uint32_t cmd_free;
        binder_uintptr_t buffer;
        uint32_t cmd_reply;
        </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> binder_transaction_data txn;
    } __attribute__((packed)) data;

<pre><code>data.cmd_free &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; BC_FREE_BUFFER;
data.buffer &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; buffer_to_free;
data.cmd_reply &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; BC_REPLY;
data.txn.target.ptr &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
data.txn.cookie &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
data.txn.code &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (status) {
    data.txn.flags &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; TF_STATUS_CODE;
    data.txn.data_size &lt;/span&gt;= &lt;span style=&quot;color: #0000ff;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
    data.txn.offsets_size &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    data.txn.data.ptr.buffer &lt;/span&gt;= (uintptr_t)&amp;amp;&lt;span style=&quot;color: #000000;&quot;&gt;status;
    data.txn.data.ptr.offsets &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
} &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; {
    data.txn.flags &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    data.txn.data_size &lt;/span&gt;= reply-&amp;gt;data - reply-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;data0;
    data.txn.offsets_size &lt;/span&gt;= ((&lt;span style=&quot;color: #0000ff;&quot;&gt;char&lt;/span&gt;*) reply-&amp;gt;offs) - ((&lt;span style=&quot;color: #0000ff;&quot;&gt;char&lt;/span&gt;*) reply-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;offs0);
    data.txn.data.ptr.buffer &lt;/span&gt;= (uintptr_t)reply-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;data0;
    data.txn.data.ptr.offsets &lt;/span&gt;= (uintptr_t)reply-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;offs0;
}
binder_write(bs, &lt;/span&gt;&amp;amp;data, &lt;span style=&quot;color: #0000ff;&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(data));</code></pre><p>}</p></span></pre><p></p>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>继续回到serviceManager里分析binder解析返回回来的服务消息</p>
<p>frameworks\native\cmds\servicemanager\servicemanager.rc</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #0000ff;">int</span> svcmgr_handler(<span style="color: #0000ff;">struct</span> binder_state *<span style="color: #000000;">bs,
                   </span><span style="color: #0000ff;">struct</span> binder_transaction_data *<span style="color: #000000;">txn,
                   </span><span style="color: #0000ff;">struct</span> binder_io *<span style="color: #000000;">msg,
                   </span><span style="color: #0000ff;">struct</span> binder_io *<span style="color: #000000;">reply)
{
    </span><span style="color: #0000ff;">struct</span> svcinfo *<span style="color: #000000;">si;
    uint16_t </span>*<span style="color: #000000;">s;
    size_t len;
    uint32_t handle;
    uint32_t strict_policy;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> allow_isolated;

<pre><code>&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;ALOGI(&quot;target=%p code=%d pid=%d uid=%d\n&quot;,
&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;      (void*) txn-&amp;gt;target.ptr, txn-&amp;gt;code, txn-&amp;gt;sender_pid, txn-&amp;gt;sender_euid);&lt;/span&gt;

&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (txn-&amp;gt;target.ptr !=&lt;span style=&quot;color: #000000;&quot;&gt; BINDER_SERVICE_MANAGER)
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (txn-&amp;gt;code ==&lt;span style=&quot;color: #000000;&quot;&gt; PING_TRANSACTION)
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;

&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; Equivalent to Parcel::enforceInterface(), reading the RPC
&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; header with the strict mode policy mask and the interface name.
&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; Note that we ignore the strict_policy and don&apos;t propagate it
&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; further (since we do no outbound RPCs anyway).&lt;/span&gt;
strict_policy =&lt;span style=&quot;color: #000000;&quot;&gt; bio_get_uint32(msg);
s &lt;/span&gt;= bio_get_string16(msg, &amp;amp;&lt;span style=&quot;color: #000000;&quot;&gt;len);
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (s ==&lt;span style=&quot;color: #000000;&quot;&gt; NULL) {
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}

&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;检查是否是servicemanager服务&lt;/span&gt;
&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; ((len != (&lt;span style=&quot;color: #0000ff;&quot;&gt;sizeof&lt;/span&gt;(svcmgr_id) / &lt;span style=&quot;color: #800080;&quot;&gt;2&lt;/span&gt;)) ||&lt;span style=&quot;color: #000000;&quot;&gt;
    memcmp(svcmgr_id, s, &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(svcmgr_id))) {
    fprintf(stderr,&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;invalid id %s\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;, str8(s, len));
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (sehandle &amp;amp;&amp;amp; selinux_status_updated() &amp;gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;) {
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;struct&lt;/span&gt; selabel_handle *tmp_sehandle =&lt;span style=&quot;color: #000000;&quot;&gt; selinux_android_service_context_handle();
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (tmp_sehandle) {
        selabel_close(sehandle);
        sehandle &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; tmp_sehandle;
    }
}

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;switch&lt;/span&gt;(txn-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;code) {
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; SVC_MGR_GET_SERVICE:
&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;检查服务，do_find_service 查找服务。&lt;/span&gt;
&lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; SVC_MGR_CHECK_SERVICE:
    s &lt;/span&gt;= bio_get_string16(msg, &amp;amp;&lt;span style=&quot;color: #000000;&quot;&gt;len);
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (s ==&lt;span style=&quot;color: #000000;&quot;&gt; NULL) {
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    }
    handle &lt;/span&gt;= do_find_service(s, len, txn-&amp;gt;sender_euid, txn-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;sender_pid);
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (!&lt;span style=&quot;color: #000000;&quot;&gt;handle)
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    bio_put_ref(reply, handle);
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;

&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;添加服务 do_add_service 获取服务 在do_add_service会检查是否具有权限&lt;/span&gt;
&lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; SVC_MGR_ADD_SERVICE:
    s &lt;/span&gt;= bio_get_string16(msg, &amp;amp;&lt;span style=&quot;color: #000000;&quot;&gt;len);
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (s ==&lt;span style=&quot;color: #000000;&quot;&gt; NULL) {
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    }
    handle &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; bio_get_ref(msg);
    allow_isolated &lt;/span&gt;= bio_get_uint32(msg) ? &lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt; : &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (do_add_service(bs, s, len, handle, txn-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;sender_euid,
        allow_isolated, txn&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;sender_pid))
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;查询服务&lt;/span&gt;
&lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; SVC_MGR_LIST_SERVICES: {
    uint32_t n &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; bio_get_uint32(msg);

    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (!svc_can_list(txn-&amp;gt;sender_pid, txn-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;sender_euid)) {
        ALOGE(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;list_service() uid=%d - PERMISSION DENIED\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;,
                txn&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;sender_euid);
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    }
    si &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; svclist;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;while&lt;/span&gt; ((n-- &amp;gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;) &amp;amp;&amp;amp;&lt;span style=&quot;color: #000000;&quot;&gt; si)
        si &lt;/span&gt;= si-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;next;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (si) {
        bio_put_string16(reply, si&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;name);
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    }
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;default&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;:
    ALOGE(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;unknown code %d\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;, txn-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;code);
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}

bio_put_uint32(reply, &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;</code></pre><p>}</p></span></pre><p></p>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码" target="_blank" rel="noopener"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div>
<p>进入 do_find_service&nbsp; do_add_service了解下做了什么事。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('259cf340-561d-4ea7-9910-93cac3ea1148')"><img id="code_img_closed_259cf340-561d-4ea7-9910-93cac3ea1148" class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img id="code_img_opened_259cf340-561d-4ea7-9910-93cac3ea1148" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('259cf340-561d-4ea7-9910-93cac3ea1148',event)" src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt>
<div id="cnblogs_code_open_259cf340-561d-4ea7-9910-93cac3ea1148" class="cnblogs_code_hide">
<pre>uint32_t do_find_service(<span style="color: #0000ff;">const</span> uint16_t *<span style="color: #000000;">s, size_t len, uid_t uid, pid_t spid)
{
    </span><span style="color: #0000ff;">struct</span> svcinfo *si =<span style="color: #000000;"> find_svc(s, len);

<pre><code>&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (!si || !si-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;handle) {
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (!si-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;allow_isolated) {
    &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; If this service doesn&apos;t allow access from isolated processes,
    &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; then check the uid to see if it is isolated.&lt;/span&gt;
    uid_t appid = uid %&lt;span style=&quot;color: #000000;&quot;&gt; AID_USER;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (appid &amp;gt;= AID_ISOLATED_START &amp;amp;&amp;amp; appid &amp;lt;=&lt;span style=&quot;color: #000000;&quot;&gt; AID_ISOLATED_END) {
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    }
}

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (!&lt;span style=&quot;color: #000000;&quot;&gt;svc_can_find(s, len, spid, uid)) {
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; si-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;handle;</code></pre><p>}</p></span></pre><p></p>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('786c6178-2ad5-466d-b516-d8e38fe7b404')"><img id="code_img_closed_786c6178-2ad5-466d-b516-d8e38fe7b404" class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img id="code_img_opened_786c6178-2ad5-466d-b516-d8e38fe7b404" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('786c6178-2ad5-466d-b516-d8e38fe7b404',event)" src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt>
<div id="cnblogs_code_open_786c6178-2ad5-466d-b516-d8e38fe7b404" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">int</span> do_add_service(<span style="color: #0000ff;">struct</span> binder_state *<span style="color: #000000;">bs,
                   </span><span style="color: #0000ff;">const</span> uint16_t *<span style="color: #000000;">s, size_t len,
                   uint32_t handle, uid_t uid, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> allow_isolated,
                   pid_t spid)
{
    </span><span style="color: #0000ff;">struct</span> svcinfo *<span style="color: #000000;">si;

<pre><code>&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;ALOGI(&quot;add_service(&apos;%s&apos;,%x,%s) uid=%d\n&quot;, str8(s, len), handle,
&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;        allow_isolated ? &quot;allow_isolated&quot; : &quot;!allow_isolated&quot;, uid);&lt;/span&gt;

&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (!handle || (len == &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;) || (len &amp;gt; &lt;span style=&quot;color: #800080;&quot;&gt;127&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;))
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;

&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;检查是否有权限&lt;/span&gt;
&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (!&lt;span style=&quot;color: #000000;&quot;&gt;svc_can_register(s, len, spid, uid)) {
    ALOGE(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;add_service(&apos;%s&apos;,%x) uid=%d - PERMISSION DENIED\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;,
         str8(s, len), handle, uid);
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}

si &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; find_svc(s, len);
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (si) {
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (si-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;handle) {
        ALOGE(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;add_service(&apos;%s&apos;,%x) uid=%d - ALREADY REGISTERED, OVERRIDE\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;,
             str8(s, len), handle, uid);
        svcinfo_death(bs, si);
    }
    si&lt;/span&gt;-&amp;gt;handle =&lt;span style=&quot;color: #000000;&quot;&gt; handle;
} &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; {
    si &lt;/span&gt;= malloc(&lt;span style=&quot;color: #0000ff;&quot;&gt;sizeof&lt;/span&gt;(*si) + (len + &lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;) * &lt;span style=&quot;color: #0000ff;&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(uint16_t));
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (!&lt;span style=&quot;color: #000000;&quot;&gt;si) {
        ALOGE(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;add_service(&apos;%s&apos;,%x) uid=%d - OUT OF MEMORY\n&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;,
             str8(s, len), handle, uid);
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; -&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    }
    si&lt;/span&gt;-&amp;gt;handle =&lt;span style=&quot;color: #000000;&quot;&gt; handle;
    si&lt;/span&gt;-&amp;gt;len =&lt;span style=&quot;color: #000000;&quot;&gt; len;
    memcpy(si&lt;/span&gt;-&amp;gt;name, s, (len + &lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;) * &lt;span style=&quot;color: #0000ff;&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(uint16_t));
    si&lt;/span&gt;-&amp;gt;name[len] = &lt;span style=&quot;color: #800000;&quot;&gt;&apos;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;\0&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&apos;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
    si&lt;/span&gt;-&amp;gt;death.func = (&lt;span style=&quot;color: #0000ff;&quot;&gt;void&lt;/span&gt;*&lt;span style=&quot;color: #000000;&quot;&gt;) svcinfo_death;
    si&lt;/span&gt;-&amp;gt;death.ptr =&lt;span style=&quot;color: #000000;&quot;&gt; si;
    si&lt;/span&gt;-&amp;gt;allow_isolated =&lt;span style=&quot;color: #000000;&quot;&gt; allow_isolated;
    si&lt;/span&gt;-&amp;gt;next =&lt;span style=&quot;color: #000000;&quot;&gt; svclist;
    svclist &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; si;
}

binder_acquire(bs, handle);
binder_link_to_death(bs, handle, &lt;/span&gt;&amp;amp;si-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;death);
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;</code></pre><p>}</p></span></pre><p></p>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h2>二. ServiceManager如何管理服务</h2>
<p>&nbsp;从上面源码分析我们知道了ServiceManager利用binder通信机制来管理一系列服务。<br>&nbsp;上面源码的执行路径可以用下图所示：（注意，图中do_find_service7 应该是do_find_service.操作手误。）</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="https://images2018.cnblogs.com/blog/612293/201807/612293-20180722114236180-75099312.png" alt></p>
<p>&nbsp;</p>
<p>　　代码分析抽象成逻辑分析，如下图所示：</p>
<p>　　　　　　　　<img src="https://images2018.cnblogs.com/blog/612293/201807/612293-20180722114323395-1692794298.png" alt></p>

</div>

</div>
</div>
      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以扫描左上角二维码头像,关注公众号。 </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>Android源码分析（十二）ServiceManager服务分析</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">6.2k</span></p>
    <p><span class="copy-title">本文作者:</span><a href="javascript:void(0)" title="网记本">网记本</a></p>
    <p><span class="copy-title">发布时间:</span>2018-07-22, 11:44:46</p>
    <p><span class="copy-title">最后更新:</span>2019-09-06, 21:20:05</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2018/07/22/Android源码分析十二ServiceManager服务分析/" title="Android源码分析（十二）ServiceManager服务分析">https://freefuncode.github.io/2018/07/22/Android源码分析十二ServiceManager服务分析/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>



    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: 'f59edbb15c434fe50f63',
            clientSecret: '5ad8f05641605b384357bd325058c4cddd58b93b',
            repo: 'FreeFunCode.github.io',
            owner: 'FreeFunCode',
            admin: ['FreeFunCode'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2019 网记本</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" href="javascript:void(0)"></a>
    </div>
</div>
<div class="acParent"></div>

</body>
<script src="//cdn.bootcss.com/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#日期格式化','#Linq','#visualStudio','#开源框架','#安卓源码','#地图','#面试','#hexo','#IIS','#SqlServer','#ViewPager','#XMLHttpRequest','#fiddler','#BroadcastReceiver','#Activity','#职业发展','#电影','#跳槽','#图片保存','#c#','#easyui','#php','#Android','#序列化','#mongodb','#评论插件','#正则表达式','#AIDL','#公众号','#设计模式','#ContentProvider','#Android7.0','#Excel操作','#Service','#GitHub','#nodejs','#LNMP','#C#文件上传','#mono_for_Android','#新浪SAE','#京东云擎','#MAMP',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("/img/article-list-background.jpeg");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
